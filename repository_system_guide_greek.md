# Οδηγός Λειτουργίας Αποθετηρίου & Σύνδεσης (Repository & Site Connection)

Αυτό το έγγραφο περιγράφει το σύστημα διαχείρισης εκπαιδευτικού υλικού (Chatbot/Repository) και πώς αυτό συνδέεται αμφίδρομα με την ιστοσελίδα του σχολείου.

---

## 1. Τι είναι το Αποθετήριο;

Το "Αποθετήριο" δεν είναι απλά μια βάση δεδομένων. Είναι ένα **ζωντανό σύστημα** που:
1.  **Αποθηκεύει:** Ερωτήσεις, Απαντήσεις και Εικόνες (Local).
2.  **Παράγει:** Διαγωνίσματα PDF κατά παραγγελία.
3.  **Συνδέεται:** Με το WordPress για να αντλεί ειδήσεις και να ελέγχει χρήστες.

---

## 2. Αρχιτεκτονική (Τα 3 Επίπεδα)

| Επίπεδο | Τεχνολογία | Ρόλος |
| :--- | :--- | :--- |
| **Site (Frontend)** | WordPress (PHP/JS) | Η "Βιτρίνα". Αναγνωρίζει τον χρήστη και φιλοξενεί το Widget. |
| **Server (Backend)** | Rasa / Python | Ο "Εγκέφαλος". Τρέχει τη λογική, την κρυπτογράφηση και την πρόσβαση στη βάση. |
| **Repository (Data)** | SQLite / Filesystem | Η "Μνήμη". Κρατάει την `questions.db` και τα αρχεία (`/files`). |

---

## 3. Η Αμφίδρομη Σύνδεση (Site <-> Repository)

Η καινοτομία του συστήματος είναι ότι η επικοινωνία δεν είναι μονόπλευρη.

### Α. Από το Site προς το Αποθετήριο (Authentication)
*   **Στόχος:** Να ξέρουμε ποιος ζητάει υλικό.
*   **Ροή:**
    1.  Ο χρήστης κάνει Login στο Σχολείο.
    2.  Το Site στέλνει κρυφά στο Chatbot: `{"role": "student", "username": "giorgos"}`.
    3.  Το Chatbot **ανοίγει το Αποθετήριο** (επιτρέπει Create Exam) μόνο αν ο ρόλος είναι έγκυρος.

### Β. Από το Αποθετήριο προς το Site (Search Integration)
*   **Στόχος:** Να δίνουμε ζωντανή πληροφόρηση.
*   **Ροή:**
    1.  Ο χρήστης ρωτάει: *"Πότε πάμε εκδρομή;"*.
    2.  Το Chatbot (Repository Logic) καλεί το **WordPress REST API**.
    3.  Το Site απαντάει με τα τελευταία άρθρα.
    4.  Το Chatbot στέλνει τα Links στον χρήστη.

> **Security Note:** Η σύνδεση αυτή γίνεται στο παρασκήνιο (Server-to-Server) και είναι ασφαλής (παρακάμπτουμε security plugins με User-Agent headers).

---

## 4. Δομή & Οργάνωση Δεδομένων

Το αποθετήριο είναι οργανωμένο ώστε να αντέχει σε επανεκκινήσεις (Persistence).

### Φάκελοι (Volumes)
*   **`data/questions.db`:** Η καρδιά του συστήματος. Περιέχει τον πίνακα `questions` με πεδία για Μάθημα, Τάξη, Δυσκολία.
*   **`files/images/`:** Εδώ αποθηκεύονται αυτόματα οι εικόνες που εξάγονται από τα Word docs.
*   **`files/generated_exams/`:** Εδώ σώζονται προσωρινά τα PDF που φτιάχνουν οι μαθητές.

### Κώδικας (`actions/actions.py`)
Το "μυαλό" του αποθετηρίου βρίσκεται στο `actions.py`:
*   **`ActionSearchArticles`:** Η γέφυρα με το Site.
*   **`ActionCreateExamNew`:** Η μηχανή παραγωγής PDF.
*   **`ActionUploadExamMaterial`:** Ο "μεταφραστής" που μετατρέπει Word σε Database entries.

---

## 5. Ροή Εργασίας (Workflow)

1.  **Teacher:** Ανεβάζει `.docx` -> Το σύστημα το "σπάει" σε ερωτήσεις/εικόνες -> `questions.db`.
2.  **Student:** Ζητάει διαγώνισμα -> Το σύστημα διαβάζει `questions.db` -> Φτιάχνει PDF -> Στέλνει Link.
3.  **Guest:** Ρωτάει πληροφορίες -> Το σύστημα ρωτάει το WordPress -> Στέλνει Links.
