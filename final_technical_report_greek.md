# Τεχνική Αναφορά Υλοποίησης Συστήματος (Rasa Chatbot & Exam Generator)

## 1. Εισαγωγή
Η παρούσα αναφορά περιγράφει την τεχνική υλοποίηση ενός διαλογικού πράκτορα (Chatbot) για εκπαιδευτική χρήση. Το σύστημα επιτρέπει την αυτοματοποιημένη δημιουργία διαγωνισμάτων σε μορφή PDF, βασισμένο σε τράπεζα θεμάτων που τροφοδοτείται από αρχεία Word (.docx). Η εγκατάσταση φιλοξενείται σε διακομιστή Linux χρησιμοποιώντας Docker containers.

---

## 2. Αρχιτεκτονική Συστήματος & Εργαλεία

Για την ανάπτυξη και λειτουργία του συστήματος χρησιμοποιήθηκαν οι εξής τεχνολογίες:

### 2.1 Πυρήνας Chatbot (Rasa Framework)
*   **Rasa Open Source (v3.x):** Χρησιμοποιήθηκε για την κατανόηση φυσικής γλώσσας (NLU) και τη διαχείριση διαλόγου (Core).
*   **Rasa SDK (Action Server):** Εκτελεί προσαρμοσμένο κώδικα Python για σύνθετες λειτουργίες (π.χ. δημιουργία PDF, πρόσβαση στη βάση δεδομένων).

### 2.2 Βάση Δεδομένων & Διαχείριση Αρχείων
*   **SQLite3:** Χρησιμοποιήθηκε ως ελαφριά, file-based βάση δεδομένων (`questions.db`) για την αποθήκευση των ερωτήσεων, των απαντήσεων και των μεταδεδομένων (μάθημα, τάξη, δυσκολία).
*   **File System:** Τα αρχεία (εικόνες, PDF, Word docs) αποθηκεύονται σε κοινόχρηστους τόμους (volumes) ώστε να είναι προσβάσιμα τόσο από τον Action Server όσο και από τον Nginx.

### 2.3 Δημιουργία Εγγράφων
*   **ReportLab (Python Library):** Βιβλιοθήκη για τη δυναμική παραγωγή των αρχείων PDF.
*   **Python-docx:** Βιβλιοθήκη για την ανάγνωση και ανάλυση (parsing) των αρχείων Word που ανεβάζουν οι εκπαιδευτικοί.

### 2.4 Υποδομή & Deployment (DevOps)
*   **Docker & Docker Compose:** Όλο το σύστημα τρέχει σε containers (απομονωμένα περιβάλλοντα), εξασφαλίζοντας σταθερότητα και εύκολη μεταφορά.
    *   `rasa`: Ο κύριος server AI.
    *   `action-server`: Ο server που τρέχει τον Python κώδικα.
    *   `nginx`: Web Server που λειτουργεί ως Reverse Proxy και εξυπηρετεί τα στατικά αρχεία (PDFs, εικόνες).
    *   `certbot`: Διαχειρίζεται τα πιστοποιητικά SSL (Let's Encrypt) για ασφαλή σύνδεση HTTPS.
*   **Git & GitHub:** Χρησιμοποιήθηκε για τον έλεγχο εκδόσεων (Version Control) και τον συγχρονισμό του κώδικα μεταξύ του τοπικού υπολογιστή ανάπτυξης και του διακομιστή (Cloud).

### 2.5 Διασύνδεση (Frontend)
*   **Rasa Webchat Widget:** Javascript βιβλιοθήκη για την ενσωμάτωση του chat στην ιστοσελίδα.
*   **WordPress Integration:** Προσαρμοσμένο script που "διαβάζει" τον ρόλο του χρήστη (Μαθητής/Καθηγητής/Admin) από το WordPress και τον στέλνει κρυφά στο Chatbot (`initPayload`), επιτρέποντας προσωποποιημένη εμπειρία και έλεγχο πρόσβασης.

---

## 3. Διαδικασία Υλοποίησης (Βήμα-προς-Βήμα)

### 3.1 Ανάλυση Εγγράφων Word (The Parser)
Αναπτύξαμε έναν αλγόριθμο (`extract_questions_from_docx`) στο αρχείο `actions.py` που:
1.  Διαβάζει το αρχείο `.docx`.
2.  Χρησιμοποιεί **Regular Expressions (Regex)** για να εντοπίζει λέξεις-κλειδιά όπως *"ΕΡΩΤΗΣΗ 1"*, *"ΘΕΜΑ Α"*, *"ΑΠΑΝΤΗΣΗ"*.
3.  Διαχωρίζει το κείμενο σε **Εκφώνηση** και **Απάντηση**.
4.  Εντοπίζει και εξάγει αυτόματα τις **εικόνες** που περιέχονται στο έγγραφο, τις αποθηκεύει τοπικά και κρατά αναφορά στη βάση δεδομένων.
5.  **Πρόκληση:** Η σωστή αντιστοίχιση ερωτήσεων-απαντήσεων όταν βρίσκονται σε διαφορετικές γραμμές.
    *   **Λύση:** Βελτιώσαμε τη λογική (`state machine`) ώστε να αλλάζει κατάσταση (mode) μόλις βρεθεί η λέξη "ΑΠΑΝΤΗΣΗ", ακόμα και αν το κείμενο είναι στην επόμενη γραμμή.

### 3.2 Αποθήκευση Δεδομένων (Database)
Δημιουργήσαμε το Custom Action `ActionUploadExamMaterial` το οποίο:
1.  Ελέγχει αν ο χρήστης είναι **Administrator** (για λόγους ασφαλείας).
2.  Καλεί τον Parser για να διαβάσει το αρχείο.
3.  Αποθηκεύει τα αποτελέσματα στον πίνακα `questions` της SQLite, μαζί με μεταδεδομένα (Subject, Grade, Difficulty) που δηλώνει ο χρήστης.

### 3.3 Παραγωγή Διαγωνίσματος (PDF Generation)
Το Action `ActionCreateExamNew`:
1.  Δέχεται τις προτιμήσεις του χρήστη (Μάθημα, Τάξη, Δυσκολία, Αριθμός Ερωτήσεων).
2.  Εκτελεί τυχαία επιλογή (`ORDER BY RANDOM()`) ερωτήσεων από τη βάση.
3.  Χρησιμοποιεί το **ReportLab** για να σχεδιάσει το PDF:
    *   Χρησιμοποιεί την ελληνική γραμματοσειρά `DejaVuSans` (για υποστήριξη Unicode/Ελληνικών).
    *   Εισάγει τις εικόνες (αν υπάρχουν) διατηρώντας τις αναλογίες.
    *   **Τελική Ρύθμιση:** Οι απαντήσεις εμφανίζονται με μπλε χρώμα (`colors.darkblue`) ακριβώς κάτω από κάθε ερώτηση (Inline answers), καθώς αυτό κρίθηκε πιο εύχρηστο από το ξεχωριστό "Λυσάρι".

### 3.4 Έλεγχος Πρόσβασης (Access Control)
Για να μην μπορεί ο καθένας να ανεβάζει υλικό:
1.  Δημιουργήσαμε το `ActionCheckUploadPermissions`.
2.  Χρησιμοποιούμε τα Slots `role` και `username` που έρχονται από το Frontend.
3.  Αν ο ρόλος δεν είναι `administrator`, το σύστημα κόβει τη διαδικασία και παραπέμπει στο email του διαχειριστή.

---

## 4. Διαδικασία DevOps & Debugging (Επίλυση Προβλημάτων)

Κατά την ανάπτυξη αντιμετωπίσαμε και λύσαμε σημαντικά προβλήματα:

1.  **Read-only Database Error:**
    *   *Πρόβλημα:* Ο Docker container δεν είχε δικαίωμα εγγραφής στο αρχείο της βάσης.
    *   *Λύση:* Ρύθμιση δικαιωμάτων στο Linux με `sudo chmod -R 777 data`.

2.  **Stale Containers (Ο Κώδικας δεν ανανεωνόταν):**
    *   *Πρόβλημα:* Παρά το `git pull`, ο server έτρεχε παλιό κώδικα.
    *   *Λύση:* Χρήση της εντολής `docker-compose up -d --build --force-recreate` για πλήρη ανακατασκευή των υπηρεσιών.

3.  **Missing Answers (Ο "Θησαυρός" ήταν άδειος):**
    *   *Πρόβλημα:* Το PDF έβγαινε χωρίς απαντήσεις.
    *   *Διάγνωση:* Δημιουργήσαμε ειδικά scripts (`server_db_check.py`, `server_parser_test.py`) που έτρεξαν *μέσα* στον server και απέδειξαν ότι η βάση είχε κενά πεδία.
    *   *Λύση:* Διορθώσαμε τον Parser (στο Python script), καθαρίσαμε τη βάση (`reset_db.py`) και ξανα-ανεβάσαμε το υλικό.

---

## 5. Συμπέρασμα
Το σύστημα είναι πλέον πλήρως λειτουργικό, ασφαλές και φιλικό προς τον χρήστη. Συνδυάζει τεχνολογίες αιχμής (AI/Chatbot) με πρακτικές λύσεις αυτοματισμού γραφείου (Word/PDF processing), προσφέροντας ένα ισχυρό εργαλείο στην εκπαιδευτική κοινότητα.
