version: "3.1"

rules:

- rule: Say pleasantries
  steps:
  - intent: greet
  - action: utter_greet

- rule: Say goodbye anytime the user says goodbye
  steps:
  - intent: goodbye
  - action: utter_goodbye

- rule: Say 'I am a bot' anytime the user challenges
  steps:
  - intent: bot_challenge
  - action: utter_iamabot

- rule: Answer contact info
  steps:
  - intent: ask_contact_info
  - action: utter_contact_info



- rule: Answer school calendar
  steps:
  - intent: ask_school_calendar
  - action: utter_school_calendar



- rule: Submit Exam Form
  condition:
  - active_loop: exam_form
  steps:
  - action: exam_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_create_exam_new

- rule: Check Permissions for Create Exam
  steps:
  - intent: create_exam
  - action: action_check_create_exam_permissions
  # If allowed, this action triggers 'exam_form' via FollowupAction

- rule: Check Permissions for Upload
  steps:
  - intent: upload_exam_material
  - action: action_check_upload_permissions
  # If allowed, this action triggers 'upload_exam_form' via FollowupAction

- rule: Submit Upload Form
  condition:
  - active_loop: upload_exam_form
  steps:
  - action: upload_exam_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_upload_exam_material

- rule: Search Website
  steps:
  - intent: search_website
  - action: action_search_articles

- rule: Respond to FAQ Contact Hours
  steps:
  - intent: faq_contact_hours
  - action: utter_faq_contact_hours

- rule: Respond to FAQ Contact Details
  steps:
  - intent: faq_contact_details
  - action: utter_faq_contact_details

- rule: Respond to FAQ Contact Person
  steps:
  - intent: faq_contact_person
  - action: utter_faq_contact_person

- rule: Respond to Smart FAQs (Parent Briefing)
  steps:
  - intent: faq_parent_briefing
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Model Exams Applications)
  steps:
  - intent: faq_model_exams_applications
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Model Exams Process)
  steps:
  - intent: faq_model_exams_process
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Model Exams Runners Up)
  steps:
  - intent: faq_model_exams_runners_up
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Attendance Info)
  steps:
  - intent: faq_attendance_info
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Absences)
  steps:
  - intent: faq_absences
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Remedial Teaching)
  steps:
  - intent: faq_remedial_teaching
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Excursions)
  steps:
  - intent: faq_excursions
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Exams)
  steps:
  - intent: faq_exams
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Admission)
  steps:
  - intent: faq_admission
  - action: action_smart_faq

- rule: Respond to Smart FAQs (Regulations)
  steps:
  - intent: faq_regulations
  - action: action_smart_faq


- rule: Respond to Student Role
  steps:
  - intent: inform_role_student
  - action: action_verify_role

- rule: Respond to Parent Role
  steps:
  - intent: inform_role_parent
  - action: action_verify_role

- rule: Respond to Teacher Role
  steps:
  - intent: inform_role_teacher
  - action: action_verify_role

- rule: Check Permissions for Study Material Upload
  steps:
  - intent: upload_study_material
  - action: action_check_study_material_upload_permissions
  # Triggers upload_study_material_form

- rule: Submit Study Material Upload Form
  condition:
  - active_loop: upload_study_material_form
  steps:
  - action: upload_study_material_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_upload_study_material_final

- rule: Activate Study Material Form
  steps:
  - intent: ask_study_material
  - action: study_material_form
  - active_loop: study_material_form

- rule: Submit Study Material Form
  condition:
  - active_loop: study_material_form
  steps:
  - action: study_material_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_provide_study_material

- rule: Ask the user to rephrase whenever they send a message with low NLU confidence
  steps:
  - intent: nlu_fallback
  - action: action_handle_fallback

- rule: Respond to Thank You
  steps:
  - intent: thankyou
  - action: utter_youarewelcome

- rule: Restart Conversation
  condition:
  # Condition logic: applies even if loop is active
  - active_loop: null
  steps:
  - intent: restart_conversation
  - action: utter_restart_now
  - action: action_restart

- rule: Restart Conversation (Loop)
  condition:
  - active_loop: study_material_form
  steps:
  - intent: restart_conversation
  - action: action_deactivate_loop
  - active_loop: null
  - action: utter_restart_now
  - action: action_restart
  - action: utter_restart_now
  - action: action_restart
